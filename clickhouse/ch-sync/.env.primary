# CH-Sync - Primary Site Configuration

# ======================
# Site Identity
# ======================
ROLE=primary

# ======================
# ClickHouse Endpoints
# ======================
# Local ClickHouse (HTTP interface)
LOCAL_CH_URL=http://localhost:8123
LOCAL_CH_USER=default
LOCAL_CH_PASSWORD=

# Remote ClickHouse (DR site)
REMOTE_CH_URL=http://192.168.100.143:8123
REMOTE_CH_USER=default
REMOTE_CH_PASSWORD=

# Remote ClickHouse native port (for remote() function)
REMOTE_CH_HOST=192.168.100.143
REMOTE_CH_PORT=9000

# ======================
# DNS Configuration
# ======================
# Update these to match your environment
DNS_RECORD=failover.mpwlabs.com
DNS_SERVER=8.8.8.8
PRIMARY_IP=192.168.100.144
DR_IP=192.168.100.143

# ======================
# Sync Settings
# ======================
# Check every 60 seconds
CHECK_INTERVAL=60

# Auto-create tables that exist on active but not passive site
AUTO_CREATE_TABLES=true

# Exclude patterns (comma-separated)
CH_EXCLUDE_PATTERNS=system.*,INFORMATION_SCHEMA.*,information_schema.*,_*,*_temp,*_staging

# Timeout for remote() connections (ms) - increase for high latency
CONNECT_TIMEOUT_MS=5000

# Parallel insert threads
MAX_INSERT_THREADS=4

# ======================
# Failback Readiness
# ======================
FAILBACK_CLEAN_CHECKS=3
STATE_FILE=/state/ch-sync-state.json

# ======================
# Notifications
# ======================
# NOTIFY_WEBHOOK=https://hooks.slack.com/services/xxx/yyy/zzz
NOTIFY_ON_GAP=true
NOTIFY_ON_SYNC=true
NOTIFY_ON_FAILBACK_READY=true
NOTIFY_ON_NEW_TABLE=true

# ======================
# Logging
# ======================
LOG_LEVEL=INFO
